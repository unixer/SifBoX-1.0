diff -r 62cd815b0757 Makefile
--- a/Makefile	Tue Sep 15 01:05:25 2009 -0400
+++ b/Makefile	Fri Aug 27 11:37:29 2010 +0200
@@ -13,8 +13,8 @@
 # not having to use the microsoft audio driver in windows
 
 CONFIG_VIDEO_EM28XX:=m
-CONFIG_DECODER_CX25843:=m
-CONFIG_DECODER_TVP5150:=m
+CONFIG_DECODER_CX25843:=n
+CONFIG_DECODER_TVP5150:=n
 CONFIG_TUNER_XC3028:=m
 CONFIG_TUNER_XC5000:=m
 CONFIG_TUNER_QT1010:=m
diff -r 62cd815b0757 adimtv102/adimtv102.c
--- a/adimtv102/adimtv102.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/adimtv102/adimtv102.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1,3 +1,5 @@
+#include <linux/slab.h>
+
 /*
  *  Driver for ADI MTV102 "Single chip dual conversion broadband tuner"
  *
diff -r 62cd815b0757 cx25843/em28xx-cx25843.c
--- a/cx25843/em28xx-cx25843.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/cx25843/em28xx-cx25843.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1,3 +1,4 @@
+#include <linux/slab.h>
 /*
  * cx25843 - Conexant cx25843 Video/Audiodecoder
  *
@@ -5,9 +6,11 @@
  */
 
 #include <linux/i2c.h>
+#include <linux/i2c-id.h>
 #include <linux/version.h>
 #include <linux/delay.h>
 #include <media/v4l2-common.h>
+#include <media/v4l2-i2c-drv.h>
 #include "em28xx-cx25843.h"
 #include "em28xx-cx25843-fw.h"
 #if LINUX_VERSION_CODE < KERNEL_VERSION(2, 6, 24)
@@ -554,6 +557,8 @@
 	.driver = &driver,
 };
 
+static const struct i2c_device_id cx25843_id;
+
 #if LINUX_VERSION_CODE >= KERNEL_VERSION(2, 5, 0)
 static int cx25843_detect_client(struct i2c_adapter *adapter,
 		int address, int kind)
@@ -591,7 +596,7 @@
 	}
 	i2c_set_clientdata(c, core);
 
-	rv = i2c_attach_client(c);
+	rv = driver.probe(c, &cx25843_id);
 
 	core->norm = V4L2_STD_ALL;	/* Default is autodetect */
 	core->route.input = CX25843_TELEVISION;
@@ -656,6 +661,23 @@
 		.command = cx25843_command,
 	};
 
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(2, 6, 26)  
+static const struct i2c_device_id cx25843_id[] = {  
+   { "cx25843", 0 },  
+   { },  
+};  
+MODULE_DEVICE_TABLE(i2c, cx25843_id);  
+#endif  
+
+static struct v4l2_i2c_driver_data v4l2_i2c_data = {  
+   .name = "cx25843",  
+   .probe = cx25843_attach_adapter,  
+   .remove = cx25843_detach_client,  
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(2, 6, 26)  
+   .id_table = cx25843_id,  
+#endif  
+};  
+
 static int __init cx25843_init(void)
 {
 	return i2c_add_driver(&driver);
diff -r 62cd815b0757 em2880-dvb.c
--- a/em2880-dvb.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/em2880-dvb.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1,3 +1,5 @@
+#include <linux/slab.h>
+
 /*
  *  Empiatech em2880 DVB-T extension
  *
@@ -247,7 +249,7 @@
 		if (dvb_dev->urb[i]) {
 			usb_kill_urb(dvb_dev->urb[i]);
 			if (dvb_dev->transfer_buffer[i]) {
-				usb_buffer_free(dvb_dev->udev,
+				usb_free_coherent(dvb_dev->udev,
 						(EM2880_DVB_NUM_PACKETS *
 						 dvb_dev->dtv_packetsize),
 						dvb_dev->transfer_buffer[i],
@@ -287,7 +289,7 @@
 			return -ENOMEM;
 		}
 		dvb_dev->transfer_buffer[i] =
-			usb_buffer_alloc(dvb_dev->udev, sb_size,
+			usb_alloc_coherent(dvb_dev->udev, sb_size,
 					GFP_KERNEL, &urb->transfer_dma);
 
 		if (!dvb_dev->transfer_buffer[i]) {
@@ -441,7 +443,7 @@
 			{0x1e, "\x52\x80", 2, 0},
 			{0x1e, "\x53\x50", 2, 0},
 			{0x1e, "\x5d\x01", 2, 0},
-			{}
+			/*{}*/
 	};
 	for (i = 0; zlconf[i].txt; i++)
 		fe->ops.write(fe, zlconf[i].txt, zlconf[i].len);
diff -r 62cd815b0757 em28xx-aad.c
--- a/em28xx-aad.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/em28xx-aad.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1,3 +1,4 @@
+#include <linux/slab.h>
 /*
  * Em28xx-aad Empia Alternative Audio Driver
  *
diff -r 62cd815b0757 em28xx-audio.c
--- a/em28xx-audio.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/em28xx-audio.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1,3 +1,4 @@
+#include <linux/slab.h>
 /*
  *  Empiatech em28x1 audio extension
  *
@@ -569,7 +570,7 @@
 		printk(KERN_ERR "em28xx-audio.c: out of memory\n");
 		return -1;
 	}
-	card = snd_card_new(index[devnr], "Em28xx Audio", THIS_MODULE, 0);
+        snd_card_create(index[devnr], "Em28xx Audio", THIS_MODULE, 0, &card); 
 	if (card == NULL) {
 		kfree(adev);
 		return -ENOMEM;
diff -r 62cd815b0757 em28xx-audioep.c
--- a/em28xx-audioep.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/em28xx-audioep.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1,3 +1,4 @@
+#include <linux/slab.h>
 /* Copyright (C) 2008 Empia Technology Inc.
  * Copyright (C) 2008 Markus Rechberger <mrechberger@gmail.com>
  */
@@ -449,7 +450,7 @@
 		printk(KERN_INFO "em28xx-audioep.c: Copyright (C) 2008 Empia Technology Inc.\n");
 		printk(KERN_INFO "em28xx-audioep.c: Copyright (C) 2008 Markus Rechberger\n");
 
-		card = snd_card_new(index[devnr], "Em28xx Audio2", THIS_MODULE, 0);
+		snd_card_create(index[devnr], "Em28xx Audio2", THIS_MODULE, 0, &card);
 
 		/* todo increase devnr .. or better make a bitmap out of it */
 
diff -r 62cd815b0757 em28xx-cards.c
--- a/em28xx-cards.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/em28xx-cards.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1211,7 +1211,7 @@
 		.has_inttuner = 1,
 		.has_tuner    = 1,
 		.decoder      = EM28XX_CX25843,
-		.ir_keytab    = ir_codes_em_kworld,
+    .ir_keytab    = &ir_codes_em_kworld_table,
 		.ir_getkey    = em2888_get_key_empia,
 		.dev_modes    = EM28XX_VIDEO | EM28XX_VBI | EM28XX_DVBT | EM28XX_AUDIO | EM28XX_RADIO,
 		.powersaving  = 1,
@@ -1353,7 +1353,7 @@
 		.tuner_type   = TUNER_XCEIVE_XC3028,
 		.tuner_addr   = 0xc2,
 		.decoder      = EM28XX_TVP5150,
-		.ir_keytab    = ir_codes_hauppauge_new_u,
+    .ir_keytab    = &ir_codes_hauppauge_new_u_table,
 		.ir_getkey    = em2880_get_key_empia,
 		.dev_modes    = EM28XX_VIDEO | EM28XX_AUDIO | EM28XX_VBI | EM28XX_DVBT,
 		.input          = {{
@@ -1382,7 +1382,7 @@
 		.has_inttuner = 1,
 		.tuner_type   = TUNER_XCEIVE_XC3028,
 		.decoder      = EM28XX_TVP5150,
-		.ir_keytab    = ir_codes_em_terratec2,
+    .ir_keytab    = &ir_codes_em_terratec2_table,
 		.ir_getkey    = em2880_get_key_terratec,
 		.dev_modes    = EM28XX_VIDEO | EM28XX_VBI,
 		.input          = {{
@@ -1410,7 +1410,7 @@
 		.norm         = V4L2_STD_PAL_BG,
 		.tuner_type   = TUNER_XCEIVE_XC3028,
 		.decoder      = EM28XX_TVP5150,
-		.ir_keytab    = ir_codes_em_terratec2,
+    .ir_keytab    = &ir_codes_em_terratec2_table,
 		.ir_getkey    = em2880_get_key_terratec,
 		.dev_modes    = EM28XX_VIDEO | EM28XX_VBI | EM28XX_DVBT,
 		.powersaving  = 1,
@@ -1548,7 +1548,7 @@
 		.has_inttuner = 1,
 		.tuner_type   = TUNER_XCEIVE_XC3028,
 		.decoder      = EM28XX_TVP5150,
-		.ir_keytab    = ir_codes_em_terratec2,
+    .ir_keytab    = &ir_codes_em_terratec2_table,
 		.ir_getkey    = em2880_get_key_terratec,
 		.dev_modes    = EM28XX_VIDEO | EM28XX_VBI | EM28XX_DVBT | EM28XX_AUDIO,
 		.input          = {{
@@ -1581,7 +1581,7 @@
 #endif
 		.tuner_type   = TUNER_XCEIVE_XC5000,
 		.decoder      = EM28XX_CX25843,
-		.ir_keytab    = ir_codes_em_terratec2,
+    .ir_keytab    = &ir_codes_em_terratec2_table,
 		.ir_getkey    = em2880_get_key_terratec,
 		.dev_modes    = EM28XX_VIDEO | EM28XX_VBI | EM28XX_DVBT | EM28XX_AUDIO | EM28XX_RADIO,
 		.input          = {{
@@ -1754,7 +1754,7 @@
 		.name         = "Pinnacle PCTV DVB-T",
 		.tuner_type   = TUNER_MT2060,
 		.dev_modes    = EM28XX_DVBT,
-		.ir_keytab    = ir_codes_pinnacle2,
+    .ir_keytab    = &ir_codes_pinnacle2_table,
 		.ir_getkey    = em2880_get_key_empia,
 #if 0
 		.manual_gpio  = 1,
@@ -1791,7 +1791,7 @@
 		.has_inttuner = 1,
 		.tuner_type   = TUNER_XCEIVE_XC3028,
 		.decoder      = EM28XX_TVP5150,
-		.ir_keytab    = ir_codes_pinnacle2,
+    .ir_keytab    = &ir_codes_pinnacle2_table,
 		.ir_getkey    = em2880_get_key_empia,
 		.dev_modes    = EM28XX_VIDEO | EM28XX_VBI | EM28XX_DVBT,
 		.input          = {{
@@ -1821,7 +1821,7 @@
 		.has_tuner    = 1,
 		.has_inttuner = 1,
 		.decoder      = EM28XX_TVP5150,
-		.ir_keytab    = ir_codes_em_pinnacle2_usb,
+    .ir_keytab    = &ir_codes_em_pinnacle2_usb_table,
 		.ir_getkey    = em2880_get_key_empia,
 		.dev_modes    = EM28XX_VIDEO | EM28XX_AUDIO | EM28XX_VBI | EM28XX_DVBT,
 		.input          = {{
@@ -2294,7 +2294,7 @@
 		.tda9887_conf = TDA9887_PRESENT,
 		.has_tuner    = 1,
 		.decoder      = EM28XX_SAA7113,
-		.ir_keytab    = ir_codes_em_gadmei_usb,
+    .ir_keytab    = &ir_codes_em_gadmei_usb_table,
 		.ir_getkey    = em2880_get_key_empia,
 		.dev_modes    = EM28XX_VIDEO,
 		.input          = {{
@@ -2413,35 +2413,6 @@
 				.id = V4L2_STD_NTSC_M
 		} },
 	},
-	[EM2820_BOARD_EETI_TVP5150] = {
-		.name          = "EETI TVP5150",
-		.vchannels     = 1,
-		.norm          = V4L2_STD_PAL_BG,
-		.decoder       = EM28XX_TVP5150,
-		.has_tuner     = 0,
-		.dev_modes      = EM28XX_VIDEO,
-		.input          = {{
-			.type     = EM28XX_VMUX_TELEVISION,
-			.vmux     = TVP5150_COMPOSITE0,
-			.amux     = 0,
-		}, {
-			.type     = EM28XX_VMUX_COMPOSITE1,
-			.vmux     = TVP5150_COMPOSITE1,
-			.amux     = 1,
-		}, {
-			.type     = EM28XX_VMUX_SVIDEO,
-			.vmux     = TVP5150_SVIDEO,
-			.amux     = 1,
-		} },
-		.tvnorms	= {
-			{
-				.name = "PAL-BG",
-				.id = V4L2_STD_PAL_BG,
-			}, {
-				.name = "NTSC",
-				.id = V4L2_STD_NTSC_M
-		} },
-	},
 	[EM2860_BOARD_NETGMBH_CAM] = {
 		.name          = "NetGMBH Cam", /* Beijing Huaqi Information Digital Technology Co., Ltd */
 		.vchannels     = 1,
@@ -2695,7 +2666,7 @@
 		.has_inttuner = 1,
 		.tuner_type   = TUNER_XCEIVE_XC3028,
 		.decoder      = EM28XX_TVP5150,
-		.ir_keytab    = ir_codes_em_kworld,
+    .ir_keytab    = &ir_codes_em_kworld_table,
 		.ir_getkey    = em2860_get_key_kaiomy,
 		.dev_modes    = EM28XX_VIDEO | EM28XX_VBI | EM28XX_AUDIO2,
 		.input          = {{
diff -r 62cd815b0757 em28xx-core.c
--- a/em28xx-core.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/em28xx-core.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1,3 +1,4 @@
+#include <linux/slab.h>
 
 
 /*
@@ -1244,7 +1245,7 @@
 		if (dev->urb[i]) {
 			usb_kill_urb(dev->urb[i]);
 			if (dev->urb[i]->transfer_buffer) {
-				usb_buffer_free(dev->udev,
+				usb_free_coherent(dev->udev,
 					dev->urb[i]->transfer_buffer_length,
 					dev->urb[i]->transfer_buffer,
 					dev->urb[i]->transfer_dma);
@@ -1285,7 +1286,7 @@
 			em28xx_uninit_isoc(dev);
 			return -ENOMEM;
 		}
-		urb->transfer_buffer = usb_buffer_alloc(dev->udev,
+		urb->transfer_buffer = usb_alloc_coherent(dev->udev,
 				sb_size, GFP_KERNEL, &urb->transfer_dma);
 		if (!urb->transfer_buffer) {
 			em28xx_errdev("unable to allocate %i bytes for "
diff -r 62cd815b0757 em28xx-i2c.c
--- a/em28xx-i2c.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/em28xx-i2c.c	Fri Aug 27 11:37:29 2010 +0200
@@ -725,12 +725,12 @@
 	struct em28xx *dev = client->adapter->algo_data;
 	int ret;
 
-	if (client->driver->id == I2C_DRIVERID_TUNER && dev->has_inttuner == 1) {
-		printk(KERN_INFO"em28xx-i2c: using internal tuner, denying "
-			"request to i2c tuner module.\n");
-		em28xx_set_tuner(-1, client);
-		return 0;
-	}
+//	if (client->driver->id == I2C_DRIVERID_TUNER && dev->has_inttuner == 1) {
+//		printk(KERN_INFO"em28xx-i2c: using internal tuner, denying "
+//			"request to i2c tuner module.\n");
+//		em28xx_set_tuner(-1, client);
+//		return 0;
+//	}
 
 	switch (client->addr << 1) {
 	case 0x86:
@@ -873,7 +873,7 @@
 	.name = "em28xx",
 	.id = I2C_HW_B_EM28XX,
 	.algo = &em28xx_algo,
-	.client_register = attach_inform,
+	
 };
 
 static struct i2c_client em28xx_client_template = {
diff -r 62cd815b0757 em28xx-input.c
--- a/em28xx-input.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/em28xx-input.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1,3 +1,5 @@
+#include <linux/slab.h>
+
 /*
   handle em28xx IR remotes via linux kernel input layer.
 
@@ -48,7 +50,7 @@
 MODULE_PARM_DESC(ir_debug, "enable debug messages [IR]");
 
 #define dprintk(fmt, arg...)	if (ir_debug) \
-	printk(KERN_DEBUG"%s/ir: " fmt, ir->c.name , ## arg)
+	printk(KERN_DEBUG"%s/ir: " fmt, ir->c->name , ## arg)
 
 /* ----------------------------------------------------------------------- */
 
@@ -78,7 +80,7 @@
 
 	timeoutval = get_timestamp();
 
-	if ((buf[0] != 0x11 || ir->btn != buf[1]) && dev->board->ir_keytab[buf[4]] != 0) {
+	if ((buf[0] != 0x11 || ir->btn != buf[1]) && dev->board->ir_keytab->scan[buf[4]].keycode != 0) {
 		if ((ir->btn != buf[1] && ir->released == 1) || ir->key != buf[4]) {
 
 #if 0
@@ -95,8 +97,8 @@
 			/* volume should be repeated faster than other keys */
 
 			if (ir->key < IR_KEYTAB_SIZE && (
-					dev->board->ir_keytab[ir->key] == KEY_VOLUMEUP ||
-					dev->board->ir_keytab[ir->key] == KEY_VOLUMEDOWN)) {
+          dev->board->ir_keytab->scan[ir->key].keycode == KEY_VOLUMEUP ||
+          dev->board->ir_keytab->scan[ir->key].keycode == KEY_VOLUMEDOWN)) {
 				dropkey = 1;
 				repeatdelay = 10;
 			} else {
@@ -221,7 +223,7 @@
 		return rc;
 	default:
 		/* keydown */
-		keycode = IR_KEYCODE(ir->keymap, ir_key);
+    keycode = (((unsigned)ir_key < IR_KEYTAB_SIZE) ? ir->keymap->scan[ir_key].keycode : KEY_RESERVED);
 		if (keycode == 0)
 			return -EINVAL;
 		input_report_key(ir->input, keycode, 1);
@@ -336,7 +338,7 @@
 				    some applications depend on it */
 	input_dev->keycode = ir->keymap;
 	for (i = 0; i < IR_KEYTAB_SIZE; i++)
-		set_bit(ir->keymap[i], input_dev->keybit);
+    set_bit(ir->keymap->scan[i].keycode, input_dev->keybit);
 
 	input_dev->keycodesize = sizeof(IR_KEYTAB_TYPE);
 	input_dev->keycodemax = IR_KEYTAB_SIZE;
@@ -372,7 +374,7 @@
 	unsigned char b;
 
 	/* poll IR chip */
-	if (1 != i2c_master_recv(&ir->c, &b, 1)) {
+	if (1 != i2c_master_recv(ir->c, &b, 1)) {
 		dprintk("read error\n");
 		return -EIO;
 	}
@@ -402,7 +404,7 @@
 	unsigned char code;
 
 	/* poll IR chip */
-	if (2 != i2c_master_recv(&ir->c, buf, 2))
+	if (2 != i2c_master_recv(ir->c, buf, 2))
 		return -EIO;
 
 	/* Does eliminate repeated parity code */
@@ -434,7 +436,7 @@
 
 	/* poll IR chip */
 
-	if (3 != i2c_master_recv(&ir->c, buf, 3)) {
+	if (3 != i2c_master_recv(ir->c, buf, 3)) {
 		dprintk("read error\n");
 		return -EIO;
 	}
@@ -499,21 +501,21 @@
 		break;
 	case EM2800_BOARD_TERRATEC_CINERGY_200:
 	case EM2820_BOARD_TERRATEC_CINERGY_250:
-		ir->ir_codes = ir_codes_em_terratec_u;
+    ir->ir_codes = &ir_codes_em_terratec_u_table;
 		ir->get_key = get_key_terratec;
-		snprintf(ir->c.name, sizeof(ir->c.name),
+		snprintf(ir->c->name, sizeof(ir->c->name),
 				"i2c IR (EM28XX Terratec)");
 		break;
 	case EM2820_BOARD_PINNACLE_USB_2:
-		ir->ir_codes = ir_codes_em_pinnacle_usb;
+    ir->ir_codes = &ir_codes_em_pinnacle_usb_table;
 		ir->get_key = get_key_pinnacle_usb;
-		snprintf(ir->c.name, sizeof(ir->c.name),
+		snprintf(ir->c->name, sizeof(ir->c->name),
 				"i2c IR (EM28XX Pinnacle PCTV)");
 		break;
 	case EM2820_BOARD_HAUPPAUGE_WINTV_USB_2:
-		ir->ir_codes = ir_codes_hauppauge_new_u;
+    ir->ir_codes = &ir_codes_hauppauge_new_u_table;
 		ir->get_key = get_key_em_haup;
-		snprintf(ir->c.name, sizeof(ir->c.name),
+		snprintf(ir->c->name, sizeof(ir->c->name),
 				"i2c IR (EM2840 Hauppauge)");
 		break;
 	case EM2820_BOARD_MSI_VOX_USB_2:
diff -r 62cd815b0757 em28xx-keymaps.c
--- a/em28xx-keymaps.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/em28xx-keymaps.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1,344 +1,380 @@
 #include "em28xx-keymaps.h"
+#include <media/ir-common.h>
 
-IR_KEYTAB_TYPE ir_codes_em_terratec_u[IR_KEYTAB_SIZE] = {
-	[0x01] = KEY_CHANNEL,
-	[0x02] = KEY_SELECT,
-	[0x03] = KEY_MUTE,
-	[0x04] = KEY_POWER,
-	[0x05] = KEY_1,
-	[0x06] = KEY_2,
-	[0x07] = KEY_3,
-	[0x08] = KEY_CHANNELUP,
-	[0x09] = KEY_4,
-	[0x0a] = KEY_5,
-	[0x0b] = KEY_6,
-	[0x0c] = KEY_CHANNELDOWN,
-	[0x0d] = KEY_7,
-	[0x0e] = KEY_8,
-	[0x0f] = KEY_9,
-	[0x10] = KEY_VOLUMEUP,
-	[0x11] = KEY_0,
-	[0x12] = KEY_MENU,
-	[0x13] = KEY_PRINT,
-	[0x14] = KEY_VOLUMEDOWN,
-	[0x16] = KEY_PAUSE,
-	[0x18] = KEY_RECORD,
-	[0x19] = KEY_REWIND,
-	[0x1a] = KEY_PLAY,
-	[0x1b] = KEY_FORWARD,
-	[0x1c] = KEY_BACKSPACE,
-	[0x1e] = KEY_STOP,
-	[0x40] = KEY_ZOOM,
+static struct ir_scancode ir_codes_em_terratec_u[] = {
+  { 0x01, KEY_CHANNEL },
+  { 0x02, KEY_SELECT },
+  { 0x03, KEY_MUTE },
+  { 0x04, KEY_POWER },
+  { 0x05, KEY_1 },
+  { 0x06, KEY_2 },
+  { 0x07, KEY_3 },
+  { 0x08, KEY_CHANNELUP },
+  { 0x09, KEY_4 },
+  { 0x0a, KEY_5 },
+  { 0x0b, KEY_6 },
+  { 0x0c, KEY_CHANNELDOWN },
+  { 0x0d, KEY_7 },
+  { 0x0e, KEY_8 },
+  { 0x0f, KEY_9 },
+  { 0x10, KEY_VOLUMEUP },
+  { 0x11, KEY_0 },
+  { 0x12, KEY_MENU },
+  { 0x13, KEY_PRINT },
+  { 0x14, KEY_VOLUMEDOWN },
+  { 0x16, KEY_PAUSE },
+  { 0x18, KEY_RECORD },
+  { 0x19, KEY_REWIND },
+  { 0x1a, KEY_PLAY },
+  { 0x1b, KEY_FORWARD },
+  { 0x1c, KEY_BACKSPACE },
+  { 0x1e, KEY_STOP },
+  { 0x40, KEY_ZOOM },
 };
-EXPORT_SYMBOL_GPL(ir_codes_em_terratec_u);
+struct ir_scancode_table ir_codes_em_terratec_u_table = {
+  .scan = ir_codes_em_terratec_u,
+  .size = ARRAY_SIZE(ir_codes_em_terratec_u),
+};
+EXPORT_SYMBOL_GPL(ir_codes_em_terratec_u_table);
 
-IR_KEYTAB_TYPE ir_codes_hauppauge_new_u[IR_KEYTAB_SIZE] = {
+static struct ir_scancode ir_codes_hauppauge_new_u[] = {
 	/* Keys 0 to 9 */
-	[0x00] = KEY_0,
-	[0x01] = KEY_1,
-	[0x02] = KEY_2,
-	[0x03] = KEY_3,
-	[0x04] = KEY_4,
-	[0x05] = KEY_5,
-	[0x06] = KEY_6,
-	[0x07] = KEY_7,
-	[0x08] = KEY_8,
-	[0x09] = KEY_9,
+  { 0x00, KEY_0 },
+  { 0x01, KEY_1 },
+  { 0x02, KEY_2 },
+  { 0x03, KEY_3 },
+  { 0x04, KEY_4 },
+  { 0x05, KEY_5 },
+  { 0x06, KEY_6 },
+  { 0x07, KEY_7 },
+  { 0x08, KEY_8 },
+  { 0x09, KEY_9 },
 
-	[0x0a] = KEY_TEXT,            /* keypad asterisk as well */
-	[0x0b] = KEY_RED,             /* red button */
-	[0x0c] = KEY_RADIO,
-	[0x0d] = KEY_MENU,
-	[0x0e] = KEY_SUBTITLE,        /* also the # key */
-	[0x0f] = KEY_MUTE,
-	[0x10] = KEY_VOLUMEUP,
-	[0x11] = KEY_VOLUMEDOWN,
-	[0x12] = KEY_PREVIOUS,        /* previous channel */
-	[0x14] = KEY_UP,
-	[0x15] = KEY_DOWN,
-	[0x16] = KEY_LEFT,
-	[0x17] = KEY_RIGHT,
-	[0x18] = KEY_VIDEO,           /* Videos */
-	[0x19] = KEY_AUDIO,           /* Music */
+  { 0x0a, KEY_TEXT },            /* keypad asterisk as well */
+  { 0x0b, KEY_RED },             /* red button */
+  { 0x0c, KEY_RADIO },
+  { 0x0d, KEY_MENU },
+  { 0x0e, KEY_SUBTITLE },        /* also the # key */
+  { 0x0f, KEY_MUTE },
+  { 0x10, KEY_VOLUMEUP },
+  { 0x11, KEY_VOLUMEDOWN },
+  { 0x12, KEY_PREVIOUS },        /* previous channel */
+  { 0x14, KEY_UP },
+  { 0x15, KEY_DOWN },
+  { 0x16, KEY_LEFT },
+  { 0x17, KEY_RIGHT },
+  { 0x18, KEY_VIDEO },           /* Videos */
+  { 0x19, KEY_AUDIO },           /* Music */
 	/* 0x1a: Pictures - presume this means
 	   "Multimedia Home Platform" -
 	   no "PICTURES" key in input.h
 	 */
-	[0x1a] = KEY_MHP,
+  { 0x1a, KEY_MHP },
 
-	[0x1b] = KEY_EPG,             /* Guide */
-	[0x1c] = KEY_TV,
-	[0x1e] = KEY_NEXTSONG,        /* skip >| */
-	[0x1f] = KEY_EXIT,            /* back/exit */
-	[0x20] = KEY_CHANNELUP,       /* channel / program + */
-	[0x21] = KEY_CHANNELDOWN,     /* channel / program - */
-	[0x22] = KEY_CHANNEL,         /* source (old black remote) */
-	[0x24] = KEY_PREVIOUSSONG,    /* replay |< */
-	[0x25] = KEY_ENTER,           /* OK */
-	[0x26] = KEY_SLEEP,           /* minimize (old black remote) */
-	[0x29] = KEY_BLUE,            /* blue key */
-	[0x2e] = KEY_GREEN,           /* green button */
-	[0x30] = KEY_PAUSE,           /* pause */
-	[0x32] = KEY_REWIND,          /* backward << */
-	[0x34] = KEY_FASTFORWARD,     /* forward >> */
-	[0x35] = KEY_PLAY,
-	[0x36] = KEY_STOP,
-	[0x37] = KEY_RECORD,          /* recording */
-	[0x38] = KEY_YELLOW,          /* yellow key */
-	[0x3b] = KEY_SELECT,          /* top right button */
-	[0x3c] = KEY_ZOOM,            /* full */
-	[0x3d] = KEY_POWER,           /* system power (green button) */
+  { 0x1b, KEY_EPG },             /* Guide */
+  { 0x1c, KEY_TV },
+  { 0x1e, KEY_NEXTSONG },        /* skip >| */
+  { 0x1f, KEY_EXIT },            /* back/exit */
+  { 0x20, KEY_CHANNELUP },       /* channel / program + */
+  { 0x21, KEY_CHANNELDOWN },     /* channel / program - */
+  { 0x22, KEY_CHANNEL },         /* source (old black remote) */
+  { 0x24, KEY_PREVIOUSSONG },    /* replay |< */
+  { 0x25, KEY_ENTER },           /* OK */
+  { 0x26, KEY_SLEEP },           /* minimize (old black remote) */
+  { 0x29, KEY_BLUE },            /* blue key */
+  { 0x2e, KEY_GREEN },           /* green button */
+  { 0x30, KEY_PAUSE },           /* pause */
+  { 0x32, KEY_REWIND },          /* backward << */
+  { 0x34, KEY_FASTFORWARD },     /* forward >> */
+  { 0x35, KEY_PLAY },
+  { 0x36, KEY_STOP },
+  { 0x37, KEY_RECORD },          /* recording */
+  { 0x38, KEY_YELLOW },          /* yellow key */
+  { 0x3b, KEY_SELECT },          /* top right button */
+  { 0x3c, KEY_ZOOM },            /* full */
+  { 0x3d, KEY_POWER },           /* system power (green button) */
 };
-EXPORT_SYMBOL_GPL(ir_codes_hauppauge_new_u);
+struct ir_scancode_table ir_codes_hauppauge_new_u_table = {
+  .scan = ir_codes_hauppauge_new_u,
+  .size = ARRAY_SIZE(ir_codes_hauppauge_new_u),
+};
+EXPORT_SYMBOL_GPL(ir_codes_hauppauge_new_u_table);
 
-IR_KEYTAB_TYPE ir_codes_pinnacle2[IR_KEYTAB_SIZE] = {
+static struct ir_scancode ir_codes_pinnacle2[] = {
 	/* Keys 0 to 9 */
-	[0x15] = KEY_0,
-	[0x08] = KEY_1,
-	[0x09] = KEY_2,
-	[0x0a] = KEY_3,
-	[0x0c] = KEY_4,
-	[0x0d] = KEY_5,
-	[0x0e] = KEY_6,
-	[0x10] = KEY_7,
-	[0x11] = KEY_8,
-	[0x12] = KEY_9,
+  { 0x15, KEY_0 },
+  { 0x08, KEY_1 },
+  { 0x09, KEY_2 },
+  { 0x0a, KEY_3 },
+  { 0x0c, KEY_4 },
+  { 0x0d, KEY_5 },
+  { 0x0e, KEY_6 },
+  { 0x10, KEY_7 },
+  { 0x11, KEY_8 },
+  { 0x12, KEY_9 },
 
-	[0x03] = KEY_POWER,
+	{ 0x03, KEY_POWER },
 
-	[0x0b] = KEY_VOLUMEUP,
-	[0x0f] = KEY_VOLUMEDOWN,
-	[0x13] = KEY_CHANNELUP,
-	[0x17] = KEY_CHANNELDOWN,
-	[0x14] = KEY_INFO,
+  { 0x0b, KEY_VOLUMEUP },
+  { 0x0f, KEY_VOLUMEDOWN },
+  { 0x13, KEY_CHANNELUP },
+  { 0x17, KEY_CHANNELDOWN },
+  { 0x14, KEY_INFO },
 
-	[0x00] = KEY_MUTE,
+	{ 0x00, KEY_MUTE },
 
-	[0x06] = KEY_PLAYPAUSE,
-	[0x04] = KEY_REWIND,
-	[0x07] = KEY_FORWARD,
-	[0x05] = KEY_STOP,
-	[0x01] = KEY_RECORD,
-	[0x02] = KEY_ZOOM, /* fullscreen */
-	[0x16] = KEY_M,
+  { 0x06, KEY_PLAYPAUSE },
+  { 0x04, KEY_REWIND },
+  { 0x07, KEY_FORWARD },
+  { 0x05, KEY_STOP },
+  { 0x01, KEY_RECORD },
+  { 0x02, KEY_ZOOM }, /* fullscreen */
+  { 0x16, KEY_M },
 
 };
-EXPORT_SYMBOL_GPL(ir_codes_pinnacle2);
+struct ir_scancode_table ir_codes_pinnacle2_table = {
+  .scan = ir_codes_pinnacle2,
+  .size = ARRAY_SIZE(ir_codes_pinnacle2),
+};
+EXPORT_SYMBOL_GPL(ir_codes_pinnacle2_table);
 
-IR_KEYTAB_TYPE ir_codes_em_gadmei_usb[IR_KEYTAB_SIZE] = {
-	[0x00] = KEY_1,
-	[0x01] = KEY_2,
-	[0x02] = KEY_3,
-	[0x03] = KEY_4,
-	[0x04] = KEY_5,
-	[0x05] = KEY_6,
-	[0x06] = KEY_7,
-	[0x07] = KEY_8,
-	[0x08] = KEY_9,
-	[0x09] = KEY_0,
-	[0x0a] = KEY_A,
-	[0x0b] = KEY_VIDEO,
-	[0x0c] = KEY_MUTE,
-	[0x0d] = KEY_PLAYPAUSE,
-	[0x0e] = KEY_DVD,
-	[0x0f] = KEY_RADIO,
-	[0x10] = KEY_VOLUMEUP,
-	[0x11] = KEY_VOLUMEDOWN,
-	[0x12] = KEY_CHANNELUP,
-	[0x13] = KEY_CHANNELDOWN,
-	[0x14] = KEY_POWER,
-	[0x15] = KEY_MENU,
-	[0x17] = KEY_STOP,
-	[0x18] = KEY_TV,
-	[0x1a] = KEY_RECORD,
-	[0x1c] = KEY_PREVIOUS,
-	[0x1e] = KEY_B,
-	[0x1f] = KEY_C,
-	[0x44] = KEY_E,
-	[0x46] = KEY_D,
-	[0x4a] = KEY_ZOOM,
+static struct ir_scancode ir_codes_em_gadmei_usb[] = {
+  { 0x00, KEY_1 },
+  { 0x01, KEY_2 },
+  { 0x02, KEY_3 },
+  { 0x03, KEY_4 },
+  { 0x04, KEY_5 },
+  { 0x05, KEY_6 },
+  { 0x06, KEY_7 },
+  { 0x07, KEY_8 },
+  { 0x08, KEY_9 },
+  { 0x09, KEY_0 },
+  { 0x0a, KEY_A },
+  { 0x0b, KEY_VIDEO },
+  { 0x0c, KEY_MUTE },
+  { 0x0d, KEY_PLAYPAUSE },
+  { 0x0e, KEY_DVD },
+  { 0x0f, KEY_RADIO },
+  { 0x10, KEY_VOLUMEUP },
+  { 0x11, KEY_VOLUMEDOWN },
+  { 0x12, KEY_CHANNELUP },
+  { 0x13, KEY_CHANNELDOWN },
+  { 0x14, KEY_POWER },
+  { 0x15, KEY_MENU },
+  { 0x17, KEY_STOP },
+  { 0x18, KEY_TV },
+  { 0x1a, KEY_RECORD },
+  { 0x1c, KEY_PREVIOUS },
+  { 0x1e, KEY_B },
+  { 0x1f, KEY_C },
+  { 0x44, KEY_E },
+  { 0x46, KEY_D },
+  { 0x4a, KEY_ZOOM },
 };
-EXPORT_SYMBOL_GPL(ir_codes_em_gadmei_usb);
+struct ir_scancode_table ir_codes_em_gadmei_usb_table = {
+  .scan = ir_codes_em_gadmei_usb,
+  .size = ARRAY_SIZE(ir_codes_em_gadmei_usb),
+};
+EXPORT_SYMBOL_GPL(ir_codes_em_gadmei_usb_table);
 
-IR_KEYTAB_TYPE ir_codes_em_pinnacle2_usb[IR_KEYTAB_SIZE] = {
-	[0x00] = KEY_MUTE,
-	[0x01] = KEY_A,
-	[0x39] = KEY_POWER,
-	[0x03] = KEY_VOLUMEUP,
-	[0x06] = KEY_CHANNELUP,
-	[0x09] = KEY_VOLUMEDOWN,
-	[0x0c] = KEY_CHANNELDOWN,
-	[0x0f] = KEY_1,
-	[0x15] = KEY_2,
-	[0x10] = KEY_3,
-	[0x18] = KEY_4,
-	[0x1b] = KEY_5,
-	[0x1e] = KEY_6,
-	[0x11] = KEY_7,
-	[0x21] = KEY_8,
-	[0x12] = KEY_9,
-	[0x24] = KEY_ZOOM,
-	[0x27] = KEY_0,
-	[0x2a] = KEY_T,
-	[0x2d] = KEY_REWIND,
-	[0x30] = KEY_PLAY,
-	[0x33] = KEY_FORWARD,
-	[0x36] = KEY_RECORD,
-	[0x3c] = KEY_STOP,
-	[0x3f] = KEY_INFO,
+static struct ir_scancode ir_codes_em_pinnacle2_usb[] = {
+  { 0x00, KEY_MUTE },
+  { 0x01, KEY_A },
+  { 0x39, KEY_POWER },
+  { 0x03, KEY_VOLUMEUP },
+  { 0x06, KEY_CHANNELUP },
+  { 0x09, KEY_VOLUMEDOWN },
+  { 0x0c, KEY_CHANNELDOWN },
+  { 0x0f, KEY_1 },
+  { 0x15, KEY_2 },
+  { 0x10, KEY_3 },
+  { 0x18, KEY_4 },
+  { 0x1b, KEY_5 },
+  { 0x1e, KEY_6 },
+  { 0x11, KEY_7 },
+  { 0x21, KEY_8 },
+  { 0x12, KEY_9 },
+  { 0x24, KEY_ZOOM },
+  { 0x27, KEY_0 },
+  { 0x2a, KEY_T },
+  { 0x2d, KEY_REWIND },
+  { 0x30, KEY_PLAY },
+  { 0x33, KEY_FORWARD },
+  { 0x36, KEY_RECORD },
+  { 0x3c, KEY_STOP },
+  { 0x3f, KEY_INFO },
 };
-EXPORT_SYMBOL_GPL(ir_codes_em_pinnacle2_usb);
 
-IR_KEYTAB_TYPE ir_codes_em_pinnacle_usb[IR_KEYTAB_SIZE] = {
-	[0x3a] = KEY_0,
-	[0x31] = KEY_1,
-	[0x32] = KEY_2,
-	[0x33] = KEY_3,
-	[0x34] = KEY_4,
-	[0x35] = KEY_5,
-	[0x36] = KEY_6,
-	[0x37] = KEY_7,
-	[0x38] = KEY_8,
-	[0x39] = KEY_9,
+struct ir_scancode_table ir_codes_em_pinnacle2_usb_table = {
+  .scan = ir_codes_em_pinnacle2_usb,
+  .size = ARRAY_SIZE(ir_codes_em_pinnacle2_usb),
+};
+EXPORT_SYMBOL_GPL(ir_codes_em_pinnacle2_usb_table);
 
-	[0x2f] = KEY_POWER,
+static struct ir_scancode ir_codes_em_pinnacle_usb[] = {
+  { 0x3a, KEY_0 },
+  { 0x31, KEY_1 },
+  { 0x32, KEY_2 },
+  { 0x33, KEY_3 },
+  { 0x34, KEY_4 },
+  { 0x35, KEY_5 },
+  { 0x36, KEY_6 },
+  { 0x37, KEY_7 },
+  { 0x38, KEY_8 },
+  { 0x39, KEY_9 },
 
-	[0x2e] = KEY_P,
-	[0x1f] = KEY_L,
-	[0x2b] = KEY_I,
+  { 0x2f, KEY_POWER },
 
-	[0x2d] = KEY_ZOOM,
-	[0x1e] = KEY_ZOOM,
-	[0x1b] = KEY_VOLUMEUP,
-	[0x0f] = KEY_VOLUMEDOWN,
-	[0x17] = KEY_CHANNELUP,
-	[0x1c] = KEY_CHANNELDOWN,
-	[0x25] = KEY_INFO,
+  { 0x2e, KEY_P },
+  { 0x1f, KEY_L },
+  { 0x2b, KEY_I },
 
-	[0x3c] = KEY_MUTE,
+  { 0x2d, KEY_ZOOM },
+  { 0x1e, KEY_ZOOM },
+  { 0x1b, KEY_VOLUMEUP },
+  { 0x0f, KEY_VOLUMEDOWN },
+  { 0x17, KEY_CHANNELUP },
+  { 0x1c, KEY_CHANNELDOWN },
+  { 0x25, KEY_INFO },
 
-	[0x3d] = KEY_LEFT,
-	[0x3b] = KEY_RIGHT,
+  { 0x3c, KEY_MUTE },
 
-	[0x3f] = KEY_UP,
-	[0x3e] = KEY_DOWN,
-	[0x1a] = KEY_PAUSE,
+  { 0x3d, KEY_LEFT },
+  { 0x3b, KEY_RIGHT },
 
-	[0x1d] = KEY_MENU,
-	[0x19] = KEY_PLAY,
-	[0x16] = KEY_REWIND,
-	[0x13] = KEY_FORWARD,
-	[0x15] = KEY_PAUSE,
-	[0x0e] = KEY_REWIND,
-	[0x0d] = KEY_PLAY,
-	[0x0b] = KEY_STOP,
-	[0x07] = KEY_FORWARD,
-	[0x27] = KEY_RECORD,
-	[0x26] = KEY_TUNER,
-	[0x29] = KEY_TEXT,
-	[0x2a] = KEY_MEDIA,
-	[0x18] = KEY_EPG,
+  { 0x3f, KEY_UP },
+  { 0x3e, KEY_DOWN },
+  { 0x1a, KEY_PAUSE },
+
+  { 0x1d, KEY_MENU },
+  { 0x19, KEY_PLAY },
+  { 0x16, KEY_REWIND },
+  { 0x13, KEY_FORWARD },
+  { 0x15, KEY_PAUSE },
+  { 0x0e, KEY_REWIND },
+  { 0x0d, KEY_PLAY },
+  { 0x0b, KEY_STOP },
+  { 0x07, KEY_FORWARD },
+  { 0x27, KEY_RECORD },
+  { 0x26, KEY_TUNER },
+  { 0x29, KEY_TEXT },
+  { 0x2a, KEY_MEDIA },
+  { 0x18, KEY_EPG },
 };
-EXPORT_SYMBOL_GPL(ir_codes_em_pinnacle_usb);
+struct ir_scancode_table ir_codes_em_pinnacle_usb_table = {
+  .scan = ir_codes_em_pinnacle_usb,
+  .size = ARRAY_SIZE(ir_codes_em_pinnacle_usb),
+};
+EXPORT_SYMBOL_GPL(ir_codes_em_pinnacle_usb_table);
 
-IR_KEYTAB_TYPE ir_codes_em_terratec2[IR_KEYTAB_SIZE] = {
-	[0x01] = KEY_POWER,
-	[0x02] = KEY_1,
-	[0x03] = KEY_2,
-	[0x04] = KEY_3,
-	[0x05] = KEY_4,
-	[0x06] = KEY_5,
-	[0x07] = KEY_6,
-	[0x08] = KEY_7,
-	[0x09] = KEY_8,
-	[0x0a] = KEY_9,
-	[0x0b] = KEY_TUNER,
-	[0x0c] = KEY_0,
-	[0x0d] = KEY_PREVIOUSSONG,
+static struct ir_scancode ir_codes_em_terratec2[] = {
+  { 0x01, KEY_POWER },
+  { 0x02, KEY_1 },
+  { 0x03, KEY_2 },
+  { 0x04, KEY_3 },
+  { 0x05, KEY_4 },
+  { 0x06, KEY_5 },
+  { 0x07, KEY_6 },
+  { 0x08, KEY_7 },
+  { 0x09, KEY_8 },
+  { 0x0a, KEY_9 },
+  { 0x0b, KEY_TUNER },
+  { 0x0c, KEY_0 },
+  { 0x0d, KEY_PREVIOUSSONG },
 
-	[0x41] = KEY_HOME,
-	[0x42] = KEY_MENU,
-	[0x43] = KEY_SUBTITLE,
-	[0x44] = KEY_TEXT,
-	[0x45] = KEY_DELETE,
-	[0x46] = KEY_TV,
-	[0x47] = KEY_DVD,
-	[0x49] = KEY_VIDEO,
-	[0x4a] = KEY_AUDIO,
-	[0x4b] = KEY_SHUFFLE,
+  { 0x41, KEY_HOME },
+  { 0x42, KEY_MENU },
+  { 0x43, KEY_SUBTITLE },
+  { 0x44, KEY_TEXT },
+  { 0x45, KEY_DELETE },
+  { 0x46, KEY_TV },
+  { 0x47, KEY_DVD },
+  { 0x49, KEY_VIDEO },
+  { 0x4a, KEY_AUDIO },
+  { 0x4b, KEY_SHUFFLE },
 
-	[0x10] = KEY_UP,
-	[0x11] = KEY_LEFT,
-	[0x12] = KEY_OK,
-	[0x13] = KEY_RIGHT,
-	[0x14] = KEY_DOWN,
+  { 0x10, KEY_UP },
+  { 0x11, KEY_LEFT },
+  { 0x12, KEY_OK },
+  { 0x13, KEY_RIGHT },
+  { 0x14, KEY_DOWN },
 
-	[0x0f] = KEY_EPG,
-	[0x16] = KEY_INFO,
-	[0x4d] = KEY_BACK,
+  { 0x0f, KEY_EPG },
+  { 0x16, KEY_INFO },
+  { 0x4d, KEY_BACK },
 
-	[0x1c] = KEY_VOLUMEUP,
-	[0x4c] = KEY_PLAY,
-	[0x1b] = KEY_CHANNELUP,
-	[0x1e] = KEY_VOLUMEDOWN,
-	[0x1d] = KEY_MUTE,
-	[0x1f] = KEY_CHANNELDOWN,
+  { 0x1c, KEY_VOLUMEUP },
+  { 0x4c, KEY_PLAY },
+  { 0x1b, KEY_CHANNELUP },
+  { 0x1e, KEY_VOLUMEDOWN },
+  { 0x1d, KEY_MUTE },
+  { 0x1f, KEY_CHANNELDOWN },
 
-	[0x17] = KEY_RED,
-	[0x18] = KEY_GREEN,
-	[0x19] = KEY_YELLOW,
-	[0x1a] = KEY_BLUE,
+  { 0x17, KEY_RED },
+  { 0x18, KEY_GREEN },
+  { 0x19, KEY_YELLOW },
+  { 0x1a, KEY_BLUE },
 
-	[0x58] = KEY_RECORD,
-	[0x48] = KEY_STOP,
-	[0x40] = KEY_PAUSE,
-	[0x54] = KEY_LAST,
-	[0x4e] = KEY_REWIND,
-	[0x4f] = KEY_FORWARD,
-	[0x5c] = KEY_NEXT,
+  { 0x58, KEY_RECORD },
+  { 0x48, KEY_STOP },
+  { 0x40, KEY_PAUSE },
+  { 0x54, KEY_LAST },
+  { 0x4e, KEY_REWIND },
+  { 0x4f, KEY_FORWARD },
+  { 0x5c, KEY_NEXT },
 };
-EXPORT_SYMBOL_GPL(ir_codes_em_terratec2);
 
+struct ir_scancode_table ir_codes_em_terratec2_table = {
+  .scan = ir_codes_em_terratec2,
+  .size = ARRAY_SIZE(ir_codes_em_terratec2),
+};
+EXPORT_SYMBOL_GPL(ir_codes_em_terratec2_table);
 
-IR_KEYTAB_TYPE ir_codes_em_kworld[IR_KEYTAB_SIZE] = {
-	[0x43] = KEY_POWER,
-	[0x03] = KEY_POWER2,
 
-	[0x04] = KEY_1,
-	[0x08] = KEY_2,
-	[0x02] = KEY_3,
-	[0x0f] = KEY_4,
-	[0x05] = KEY_5,
-	[0x06] = KEY_6,
-	[0x0c] = KEY_7,
-	[0x0d] = KEY_8,
-	[0x0a] = KEY_9,
-	[0x11] = KEY_0,
+static struct ir_scancode ir_codes_em_kworld[] = {
+  { 0x43, KEY_POWER },
+  { 0x03, KEY_POWER2 },
 
-	[0x09] = KEY_CHANNELUP,
-	[0x07] = KEY_CHANNELDOWN,
-	[0x0e] = KEY_VOLUMEUP,
-	[0x13] = KEY_VOLUMEDOWN,
+  { 0x04, KEY_1 },
+  { 0x08, KEY_2 },
+  { 0x02, KEY_3 },
+  { 0x0f, KEY_4 },
+  { 0x05, KEY_5 },
+  { 0x06, KEY_6 },
+  { 0x0c, KEY_7 },
+  { 0x0d, KEY_8 },
+  { 0x0a, KEY_9 },
+  { 0x11, KEY_0 },
 
-	[0x01] = KEY_TUNER,
-	[0x0b] = KEY_ZOOM,
+  { 0x09, KEY_CHANNELUP },
+  { 0x07, KEY_CHANNELDOWN },
+  { 0x0e, KEY_VOLUMEUP },
+  { 0x13, KEY_VOLUMEDOWN },
 
-	[0x16] = KEY_PLAY,
-	[0x17] = KEY_MUTE,
-	[0x14] = KEY_RECORD,
-	[0x15] = KEY_STOP,
+  { 0x01, KEY_TUNER },
+  { 0x0b, KEY_ZOOM },
 
-	[0x18] = KEY_UP,
-	[0x19] = KEY_DOWN,
-	[0x1a] = KEY_LEFT,
-	[0x1b] = KEY_RIGHT,
+  { 0x16, KEY_PLAY },
+  { 0x17, KEY_MUTE },
+  { 0x14, KEY_RECORD },
+  { 0x15, KEY_STOP },
 
-	[0x1c] = KEY_RED,
-	[0x1d] = KEY_GREEN,
-	[0x1e] = KEY_YELLOW,
-	[0x1f] = KEY_BLUE,
+  { 0x18, KEY_UP },
+  { 0x19, KEY_DOWN },
+  { 0x1a, KEY_LEFT },
+  { 0x1b, KEY_RIGHT },
 
-	[0x12] = KEY_OK,
-	[0x10] = KEY_HOME
+  { 0x1c, KEY_RED },
+  { 0x1d, KEY_GREEN },
+  { 0x1e, KEY_YELLOW },
+  { 0x1f, KEY_BLUE },
+
+  { 0x12, KEY_OK },
+  { 0x10, KEY_HOME }
 };
-EXPORT_SYMBOL_GPL(ir_codes_em_kworld);
+
+struct ir_scancode_table ir_codes_em_kworld_table = {
+  .scan = ir_codes_em_kworld,
+  .size = ARRAY_SIZE(ir_codes_em_kworld),
+};
+EXPORT_SYMBOL_GPL(ir_codes_em_kworld_table);
diff -r 62cd815b0757 em28xx-keymaps.h
--- a/em28xx-keymaps.h	Tue Sep 15 01:05:25 2009 -0400
+++ b/em28xx-keymaps.h	Fri Aug 27 11:37:29 2010 +0200
@@ -6,12 +6,12 @@
 #define IR_KEYTAB_TYPE  u32
 #define IR_KEYTAB_SIZE  128 /* enougth for rc5, probably need more some day...*/
 
-extern IR_KEYTAB_TYPE ir_codes_pinnacle2[IR_KEYTAB_SIZE];
-extern IR_KEYTAB_TYPE ir_codes_em_pinnacle_usb[IR_KEYTAB_SIZE];
-extern IR_KEYTAB_TYPE ir_codes_em_terratec2[IR_KEYTAB_SIZE];
-extern IR_KEYTAB_TYPE ir_codes_em_pinnacle2_usb[IR_KEYTAB_SIZE];
-extern IR_KEYTAB_TYPE ir_codes_em_gadmei_usb[IR_KEYTAB_SIZE];
-extern IR_KEYTAB_TYPE ir_codes_em_terratec_u[IR_KEYTAB_SIZE];
-extern IR_KEYTAB_TYPE ir_codes_hauppauge_new_u[IR_KEYTAB_SIZE];
-extern IR_KEYTAB_TYPE ir_codes_em_kworld[IR_KEYTAB_SIZE];
+extern struct ir_scancode_table ir_codes_pinnacle2_table;
+extern struct ir_scancode_table ir_codes_em_pinnacle_usb_table;
+extern struct ir_scancode_table ir_codes_em_terratec2_table;
+extern struct ir_scancode_table ir_codes_em_pinnacle2_usb_table;
+extern struct ir_scancode_table ir_codes_em_gadmei_usb_table;
+extern struct ir_scancode_table ir_codes_em_terratec_u_table;
+extern struct ir_scancode_table ir_codes_hauppauge_new_u_table;
+extern struct ir_scancode_table ir_codes_em_kworld_table;
 #endif
diff -r 62cd815b0757 em28xx-video.c
--- a/em28xx-video.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/em28xx-video.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1173,7 +1173,7 @@
  * em28xx_v4l2_poll()
  * will allocate buffers when called for the first time
  */
-static unsigned int em28xx_v4l2_poll(struct file *filp, struct poll_table_struct *wait)
+static unsigned int em28xx_v4l2_poll(struct file *filp, poll_table *wait)
 {
 	unsigned int mask = 0;
 	struct em28xx_fh *fh = filp->private_data;
@@ -1923,7 +1923,7 @@
  * em28xx_v4l2_ioctl() via em28xx_video_do_ioctl(). Userspace
  * copying is done already, arg is a kernel pointer.
  */
-static int em28xx_do_ioctl(struct file *filp,
+static int em28xx_do_ioctl(struct inode *inode, struct file *filp,
 			   struct em28xx *dev, unsigned int cmd, void *arg,
 			   v4l2_kioctl driver_ioctl)
 {
@@ -2879,15 +2879,12 @@
 		return em28xx_do_ioctl(inode, filp, dev, cmd, arg,
 					em28xx_video_do_ioctl);
 #else
-		return em28xx_do_ioctl(filp, dev, cmd, arg,
-				       em28xx_v4l2_ioctl);
+                return em28xx_v4l2_ioctl(filp, cmd, arg);
 #endif
 	}
 	return 0;
 }
 
-
-
 /*
  * em28xx_v4l2_ioctl()
  * Handle V4L2 ioctl. Has the prototype of v4l2_kioctl.
@@ -2919,7 +2916,7 @@
 #if LINUX_VERSION_CODE < KERNEL_VERSION(2, 6, 29)
 	ret = video_usercopy(NULL, filp, cmd, (unsigned long)arg, em28xx_video_do_ioctl);
 #else
-	ret = video_usercopy(filp, cmd, (unsigned long)arg, em28xx_video_do_ioctl);
+	ret = video_usercopy(filp, cmd, (unsigned long)arg, (v4l2_kioctl) em28xx_v4l2_ioctl);
 #endif
 
 	return ret;
@@ -2934,7 +2931,7 @@
  * struct v4l2_ioctl_ops. The struct v4l2_ioctl_ops was introduced with commit
  * http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commitdiff;h=a399810ca69d9d4bd30ab8c1678c7439e567f90b
  */
-static int em28xx_v4l2_ioctl_fops(struct file *filp,
+static long em28xx_v4l2_ioctl_fops(struct file *filp,
 			     unsigned int cmd, unsigned long arg)
 {
 #if LINUX_VERSION_CODE < KERNEL_VERSION(2, 6, 28)
diff -r 62cd815b0757 em28xx.h
--- a/em28xx.h	Tue Sep 15 01:05:25 2009 -0400
+++ b/em28xx.h	Fri Aug 27 11:37:29 2010 +0200
@@ -136,7 +136,6 @@
 #define EM2888_BOARD_TERRATEC_XS_HTC		  80
 #define EM2885_BOARD_EMPIA_DVBC                   81
 #define EM28175_BOARD_EMPIA_HYBRID                82
-#define EM2820_BOARD_EETI_TVP5150		  83
 
 #ifndef TUNER_XCEIVE_XC5000
 #define TUNER_XCEIVE_XC5000 10000
@@ -521,7 +520,7 @@
 	int (*gctrl)(struct em28xx *dev, struct v4l2_control *ctrl);
 	int (*qctrl)(struct v4l2_queryctrl *qctrl);
 
-	IR_KEYTAB_TYPE *ir_keytab;
+	struct ir_scancode_table *ir_keytab;
 	int (*ir_getkey)(struct em28xx *dev, u32 *ir_key, u32 *keystatus);
 
 	struct em28xx_input       input[MAX_EM28XX_INPUT];
@@ -620,7 +619,7 @@
 struct em2880_ir {
 	u8      old;
 	u8      sequence[4];
-	IR_KEYTAB_TYPE		*keymap;
+	struct ir_scancode_table		*keymap;
 #if LINUX_VERSION_CODE < KERNEL_VERSION(2, 6, 20)
 	struct work_struct work;
 #else
diff -r 62cd815b0757 lgdt3304/lgdt3304.c
--- a/lgdt3304/lgdt3304.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/lgdt3304/lgdt3304.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1,3 +1,4 @@
+#include <linux/slab.h>
 /*
  *  Driver for LG ATSC lgdt3304 driver
  *
diff -r 62cd815b0757 mt2060/mt2060.c
--- a/mt2060/mt2060.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/mt2060/mt2060.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1,3 +1,4 @@
+#include <linux/slab.h>
 /*
  *  Driver for Microtune MT2060 "Single chip dual conversion broadband tuner"
  *
diff -r 62cd815b0757 qt1010/qt1010.c
--- a/qt1010/qt1010.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/qt1010/qt1010.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1,3 +1,4 @@
+#include <linux/slab.h>
 /*
  *  Driver for Quantek QT1010 silicon tuner
  *
diff -r 62cd815b0757 sharp/s921_module.c
--- a/sharp/s921_module.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/sharp/s921_module.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1,3 +1,4 @@
+#include <linux/slab.h>
 /*
  * Driver for Sharp s921 driver
  *
diff -r 62cd815b0757 tvp5150/tvp5150.c
--- a/tvp5150/tvp5150.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/tvp5150/tvp5150.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1,3 +1,4 @@
+#include <linux/slab.h>
 /*
  * tvp5150 - Texas Instruments TVP5150A/AM1 video decoder driver
  *
diff -r 62cd815b0757 xc3028/xc3028_module.c
--- a/xc3028/xc3028_module.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/xc3028/xc3028_module.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1,3 +1,4 @@
+#include <linux/slab.h>
 #include <linux/kernel.h>
 #include <linux/module.h>
 #include <linux/i2c.h>
diff -r 62cd815b0757 xc5000/xc5000_module.c
--- a/xc5000/xc5000_module.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/xc5000/xc5000_module.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1,3 +1,5 @@
+#include <linux/slab.h>
+#include <linux/slab.h>
 #include <linux/kernel.h>
 #include <linux/module.h>
 #include <linux/i2c.h>
diff -r 62cd815b0757 zl10353/zl10353.c
--- a/zl10353/zl10353.c	Tue Sep 15 01:05:25 2009 -0400
+++ b/zl10353/zl10353.c	Fri Aug 27 11:37:29 2010 +0200
@@ -1,3 +1,4 @@
+#include <linux/slab.h>
 /*
  * Driver for Zarlink DVB-T ZL10353 demodulator
  *
