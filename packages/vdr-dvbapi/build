#!/bin/sh

. config/options

get_meta linux
verlte 3.6.11 $PKG_VERSION && INSDVB="yes" || INSDVB="no"
if [ $INSDVB = "no" ]; then
   DVB_DIR="$SYSROOT_PREFIX/usr/include"
else
   DVB_DIR="../linux"
fi

get_meta $1

VDR_DIR=`basename $BUILD/vdr-1*`

CFLAGS="$CFLAGS -fPIC"
CXXFLAGS="$CXXFLAGS -fPIC"
LDFLAGS="$LDFLAGS -fPIC"

cd $PKG_BUILD_DIR

if [ $TARGET_PLATFORM = "ion" ]; then
  patch -p1 < $ROOT/$PACKAGES/$1/patches/02_machines.patch.ion
fi

make \
  VDRDIR="../$VDR_DIR" \
  LIBDIR="." \
  DVBDIR=$DVB_DIR \
  LOCALEDIR="./locale"

do_strip bin lib$1.so.*
