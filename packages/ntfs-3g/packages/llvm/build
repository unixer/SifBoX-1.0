#!/bin/sh

. config/options

get_meta $1

cd $PKG_BUILD_DIR

cd autoconf
aclocal --force --verbose -I m4
autoconf -v -f -I m4 -o ../configure
cd ..

mkdir -p objdir-target 
cd objdir-target

[ "$TARGET_ARCH" = i386 ] && ARCH=x86 || ARCH=$TARGET_ARCH

do_configure --host=$HOST_NAME \
             --build=$HOST_NAME \
             --enable-polly \
             --enable-optimized \
             --disable-profiling \
             --disable-assertions \
             --disable-expensive-checks \
             --enable-experimental-targets=R600 \
             --disable-debug-runtime \
             --disable-debug-symbols \
             --enable-jit \
             --disable-docs \
             --disable-doxygen \
             --enable-threads \
             --enable-pthreads \
             --enable-pic \
             --enable-shared \
             --enable-embed-stdcxx \
             --enable-timestamps \
             --enable-targets=$ARCH \
             --disable-libffi \
             --disable-ltdl-install \

export LLVM_TBLGEN="$ROOT/$TOOLCHAIN/bin/llvm-tblgen"

make -j4
make_install
