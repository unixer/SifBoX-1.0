#!/bin/sh

. config/options

cd $BUILD/$1*

#make config VERSION=r3p1 ABI=armel EGL_TYPE=framebuffer
make config VERSION=r3p1 ABI=armhf EGL_TYPE=x11
make

install_dir="$PWD/.install/usr"
install_dir_debug="$PWD/.install-debuginfo"

rm -rf "$install_dir"
mkdir -p "$install_dir/lib"
mkdir -p "$install_dir/include"

cp -r lib/mali/r3p1/armhf/x11/libMali.so $install_dir/lib
cp -r lib/ump/libUMP.so.3 $install_dir/lib

ln -s libEGL.so.1 $install_dir/lib/libEGL.so
ln -s libEGL.so.1.4 $install_dir/lib/libEGL.so.1
ln -s libMali.so $install_dir/lib/libEGL.so.1.4
ln -s libGLESv1_CM.so.1 $install_dir/lib/libGLESv1_CM.so
ln -s libGLESv1_CM.so.1.1 $install_dir/lib/libGLESv1_CM.so.1
ln -s libMali.so $install_dir/lib/libGLESv1_CM.so.1.1
ln -s libGLESv2.so.2 $install_dir/lib/libGLESv2.so
ln -s libGLESv2.so.2.0 $install_dir/lib/libGLESv2.so.2
ln -s libMali.so $install_dir/lib/libGLESv2.so.2.0
ln -s libUMP.so.3 $install_dir/lib/libUMP.so

cp -r include/EGL $install_dir/include
cp -r include/GLES* $install_dir/include
cp -r include/KHR $install_dir/include
cp -r include/ump $install_dir/include 

#mkdir usr
#mv lib usr
#mv include usr
#mv share usr
#cp -PR usr $install_dir

strip_libs "$install_dir"     "$install_dir_debug/usr/lib/debug"
strip_bins "$install_dir" "$install_dir_debug/usr/lib/debug"
