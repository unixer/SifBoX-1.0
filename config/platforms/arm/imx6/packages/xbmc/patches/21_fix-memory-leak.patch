From d4696c8304c3d9e8a7e18abde4a5ca94559365b4 Mon Sep 17 00:00:00 2001
From: wolfgar <stephan.rafin@laposte.net>
Date: Tue, 3 Dec 2013 22:01:46 +0100
Subject: [PATCH] Fix memory leak (Thanks Rudi)

---
 xbmc/cores/dvdplayer/DVDCodecs/Video/DVDVideoCodecIMX.cpp | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/xbmc/cores/dvdplayer/DVDCodecs/Video/DVDVideoCodecIMX.cpp b/xbmc/cores/dvdplayer/DVDCodecs/Video/DVDVideoCodecIMX.cpp
index 6144af6..b9fcf97 100644
--- a/xbmc/cores/dvdplayer/DVDCodecs/Video/DVDVideoCodecIMX.cpp
+++ b/xbmc/cores/dvdplayer/DVDCodecs/Video/DVDVideoCodecIMX.cpp
@@ -774,6 +774,7 @@ bool CDVDVideoCodecIMX::VpuDeQueueFrame(bool wait)
   m_tsSyncRequired = true;  
   m_dropState = false;
   m_tsm = NULL;
+  m_convert_bitstream = false;
 }
 
 CDVDVideoCodecIMX::~CDVDVideoCodecIMX()
@@ -1007,6 +1008,14 @@ void CDVDVideoCodecIMX::Dispose(void)
     m_tsm = NULL;
   }
 
+  if (m_convert_bitstream)
+  {
+    if (m_sps_pps_context.sps_pps_data)
+    {
+      free(m_sps_pps_context.sps_pps_data);
+      m_sps_pps_context.sps_pps_data = NULL;
+    }
+  }
   return;
 }
 
-- 
1.8.5.1

